## 가능한 한 실패 원자적으로 만들라



**실패 원자적**이라는 말은 호출 메서드가 실패하더라도, 해당 객체는 메서드의 호출 전 상태를 유지해야 한다. 라는 의미이다.



실패 원자적으로 예외를 작성하기 위한 방법들은 다음과 같다.



### 불변 객체로 설계한다

불변 객체는 태생적으로 실패 원자적이다. 메서드가 실패하면 새로운 객체가 만들어지지 않을 수는 있지만, 기존 객체가 불안정한 상태에 빠지는 일은 절대 없다.



### 매개변수의 유효성을 검사한다

가변 객체의 메서드를 실패 원자적으로 만드는 가장 흔한 방법이다.

실패 가능성 있는 모든 코드에 대해 객체 상태를 바꾸는 코드보다 앞에 배치하는 전략이다.

```java
public Object pop() {
  if(size == 0) {
    throw new EmptyStackException();
  }
  Object result = elements[--size];
  elements[size] = null;
  return result;
}
```

> Stack.pop() 





### 임시 복사본 사용

임시 복사본에서 작업을 수행한 후 작업이 성공적으로 완료되면 원래 객체와 교체하는 방법으로, 

데이터를임시 자료구조에 저장해 작업하는 게 더 빠를 때 적용하기 좋은 방식.

> 정렬알고리즘의 DP는 성능 향상과 임시 복사본으로써의 입력값 불변이라는 측면에서도 효과적.





### 작업도중 발생하는 실패를 가로채는 복구 코드를 작성

디스크의 내구성을 보장해야하는 자료구조에 쓰이는데, 자주쓰이는 방법은 아니라고 함.





### 참고

실패 원자성이 지켜지지 않는다면 실패 시 객체상태를 API 설명에 꼭 명시해야한다.

